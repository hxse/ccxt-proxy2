<!DOCTYPE html>
<html>

<head>
    <title>测试数据 API</title>
</head>

<body>
    <h1>测试数据下载</h1>
    <div>
        <label for="tokenInput">输入 Token:</label>
        <input type="text" id="tokenInput" value="{}">
    </div>

    <button onclick="listFiles()">列出并下载文件</button>

    <div id="result"></div>
    <ul id="fileList"></ul>

    <script>
        function getToken() {
            return document.getElementById('tokenInput').value;
        }

        function listFiles() {
            const token = getToken();
            fetch('/download/list_files', {
                headers: { 'Authorization': 'Bearer ' + token }
            })
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    const fileList = document.getElementById('fileList');
                    fileList.innerHTML = ''; // 清空旧列表
                    if (data.files && data.files.length > 0) {
                        document.getElementById('result').innerText = '文件列表：';
                        data.files.forEach(fileName => {
                            const li = document.createElement('li');
                            const a = document.createElement('a');
                            // 注意：这里使用 "/download/files/" 前缀来访问静态文件服务
                            a.href = `/download/files/${fileName}`;
                            a.textContent = fileName;
                            a.download = fileName; // 确保下载而不是打开
                            li.appendChild(a);
                            fileList.appendChild(li);
                        });
                    } else {
                        document.getElementById('result').innerText = '目录下没有文件。';
                    }
                })
                .catch(error => {
                    document.getElementById('result').innerText = 'Error: ' + error.message;
                });
        }
    </script>
</body>

</html>
